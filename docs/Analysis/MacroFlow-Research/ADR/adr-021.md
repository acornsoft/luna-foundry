# 021. Develop Azure CLI Extension for Setting Multiline Format to Markdown on Work Items

Date: 2026-01-10

## Status

Accepted

## Context

Work items in Azure DevOps for Luna Foundry are stored in HTML format, causing command-line issues when updating via az CLI due to special characters and long content. To enable Markdown support for multiline fields (e.g., Description, AcceptanceCriteria, History), set multilineFieldsFormat to "markdown" globally or per item. Existing az boards commands don't support this; REST API does but requires custom logic.

## Decision

Develop a Python Azure CLI extension named `az boards work-item set-multiline-format` with the following features:
- Flexible scoping: --wiql (custom query), --ids (comma-separated), --work-item-types (auto-build query), --parent-id (children query).
- Field targeting: --fields (default: System.Description,Microsoft.VSTS.Common.AcceptanceCriteria,System.History).
- Safety: --dry-run mode.
- Implementation: Use subprocess for az boards query (leverages existing auth), REST API PATCH for updates (sets multilineFieldsFormat to "markdown").
- Architecture: Modular azext_ package with CLI parser, query builder, API client.
This enables Markdown support for all work items where fields support it, opposed to HTML, without converting existing content.

## Consequences

- Pros: Enables Markdown support for work items without changing existing content; flexible for all user scenarios; safe with dry-run; integrates with az ecosystem.
- Cons: Does not convert HTML to Markdown; requires manual conversion if needed; adds extension dependency; requires az login and PAT for API; potential API throttling on large batches.
- Risks: Updates fail if work item type/process doesn't support Markdown (handled gracefully with logging).
- Alternatives Considered: Enforce by converting content (option 1, rejected), modify existing az commands (not feasible), use PowerShell script only (less portable), direct REST without az (complex auth).